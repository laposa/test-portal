---
const { selector, select, tests, fresh, link } = Astro.props;
import type { TestSuite } from '../interfaces';
import TestList from './TestList.astro';

const mockSuites: TestSuite[] = [
	{
		id: 1,
		title: 'Test Suite 1',
		passed: 2,
		failed: 1,
	},
	{
		id: 2,
		title: 'Test Suite 2',
		passed: 2,
		failed: 1,
	},
];

const freshSuites: TestSuite[] = [
	{
		id: 1,
		title: 'Test Suite 1',
		passed: 0,
		failed: 0,
	},
	{
		id: 2,
		title: 'Test Suite 2',
		passed: 0,
		failed: 0,
	},
];
---

<script>
	const suites = document.querySelectorAll('.checkbox.suite input');
	suites.forEach((suite) => {
		suite.addEventListener('change', (e) => {
			const id = e.target.id;
			const target = document.getElementById(id.replace('-suite-', '-suite-tests-'));
			target?.querySelectorAll('input[type="checkbox"').forEach((test) => {
				test.checked = e.target.checked;
			});
		});
	});
</script>

<table class:list={[{select: select}]}>
	<thead>
		<tr>
			{ select && 
				<th>
					<label for={selector + "-all"} class="checkbox all">
						<input type="checkbox" id={selector + "-all"}>
						<span class="checkmark"></span>
					</label>
				</th>
			}
			<th>Test suite</th>
			<th class="center">Last result<br>Pass/Fail</th>
			<th>Tests</th>
		</tr>
	</thead>
	<tbody>
		{
			(fresh ? freshSuites : mockSuites).map((suite) => (
				<tr>
					{ select && 
						<td>
							<label for={selector + "-suite-" + suite.id} class="checkbox suite">
								<input type="checkbox" id={selector + "-suite-" + suite.id}>
								<span class="checkmark"></span>
							</label>
						</td>
					}
          <td>{suite.title}</td>
          <td class="center"><span class="pass">{suite.passed}</span>/<span class="fail">{suite.failed}</span></td>
          <td><span class="expand" data-target={selector + "-suite-tests-" + suite.id}>Expand</span></td>
        </tr>
        <tr id={selector + "-suite-tests-" + suite.id} class="collapsible">
					<td colspan={select ? 4 : 3}>
						<TestList selector={"suite-" + suite.id} select={select} tests={tests} link={link}/>
					</td>
        </tr>
			))
		}
	</tbody>
</table>

<style>
</style>